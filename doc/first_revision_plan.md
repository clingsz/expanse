# First Revision Plan - Idle Number Game Transformation

**Date:** 2026-01-18
**Status:** FINALIZED - Ready for Implementation
**Goal:** Transform from region-based strategy to pure idle/incremental number game

---

## Confirmed Design Decisions

| Topic | Decision |
|-------|----------|
| Resource naming | **Space** (replaces "slots") |
| Combat trigger | **Time-based** with threat threshold (protects early game) |
| Defeat condition | **Game Over** - reset everything |
| Combat system | **Ordered list** - Units → Defense → Base (damage passes through) |
| Research | **Keep similar** - science packs unlock buildings/upgrades |
| End game | **Endless** - pure idle, no win condition |
| Energy | **Standard resource** - consumed like materials, no production if insufficient |
| Energy safety net | **Base provides passive +10 Energy/sec** - prevents death spirals |
| Play mode | **Active play only** - no offline/AFK progression (faster pacing) |
| Resource UI | **Net rate breakdown** - show (+Production - Consumption = Net) with colors |

---

## Vision Summary

Transform "Expansion Front" into a **pure idle/incremental number game** where:
- Everything is number-based (buildings, resources, combat)
- No region/map concepts - single unified space
- Simple click-to-build gameplay with satisfying number growth
- Periodic threat-based combat with ordered unit list
- Endless progression

---

## Core Systems

### 1. Space System

**Space** is a resource that limits building capacity.

- Base starting space: 10
- **Expander buildings** increase max space
- More expanders → Higher threat level (risk/reward)
- All buildings consume space when built

```
Space: 15/20 used
[Expander] - Costs: 50 Iron, 20 Copper | Provides: +5 Space | Adds: +1 Threat
```

### 2. Building System

**Single-function buildings** - no recipe selection needed.

| Old System | New System |
|------------|------------|
| Assembler + select "Circuit" recipe | `assembler-circuit` building |
| Furnace + select "Iron Plate" recipe | `furnace-iron-plate` building |
| Miner on iron node | `miner-iron` building |

**Building categories:**
- **Miners:** `miner-iron`, `miner-copper`, `miner-coal`, etc.
- **Smelters:** `furnace-iron-plate`, `furnace-copper-plate`, `furnace-steel`
- **Assemblers:** `assembler-gear`, `assembler-circuit`, `assembler-science-basic`
- **Power:** `generator-coal`, `generator-solar`, `generator-wind`
- **Defense:** `turret-basic`, `turret-laser`, `wall-basic`
- **Military:** `factory-drone-gun`, `factory-drone-laser`
- **Infrastructure:** `expander`, `storage-upgrade`, `research-lab`

**Production cycle:** Every 0.5 seconds, all buildings of each type produce simultaneously.

### 3. Resource System

All resources work the same way (including **Energy**):
- Current amount / Storage capacity
- Storage can be upgraded (costs Space)
- Production stops if any input resource is insufficient

**Energy Safety Net:**
- The **Base** building provides passive energy generation: `+10 Energy/sec`
- Prevents "death spiral" where zero energy stops all production
- Can be upgraded via Technology ("Core Reactor Efficiency")
- System can always slowly restart itself

```javascript
// Example production check
furnace-iron-plate requires: { "iron-ore": 1, "energy": 2 }
produces: { "iron-plate": 1 }

// If iron-ore < 1 OR energy < 2 → no production, no consumption
```

**Resource categories:**
- **Raw:** Iron Ore, Copper Ore, Coal, Stone
- **Materials:** Iron Plate, Copper Plate, Steel, Gear, Circuit
- **Energy:** Energy (generated by power buildings + base, consumed by most buildings)
- **Military:** Drones, Ammo
- **Science:** Science Packs
- **Meta:** Space (building capacity)

**Active Play Focus:**
- No offline/AFK progression in first version
- Game requires window to be open
- Balance pacing for active sessions (faster ticks/progression)
- "Safe Mode" / background running is low priority

### 4. Combat System

**Ordered List Combat** - damage flows through units in order.

**Player side (front to back):**
```
[Drones] → [Turrets/Defense] → [Base]
    ↑ Enemies attack here first
```

**Enemy side (front to back):**
```
[Enemy Units] → [Enemy Base/Boss (future)]
    ↑ Player attacks here first
```

**Combat flow:**
1. Timer counts down (based on threat level)
2. When timer reaches 0 AND threat > threshold → Enemy wave spawns
3. Combat resolves automatically:
   - Player units attack enemy front
   - Enemy units attack player front
   - Damage passes to next unit when current dies
4. If all enemies defeated → Victory, timer resets
5. If Base health reaches 0 → **Game Over**

**Threat Level:**
- Increases with: Expander buildings, total buildings, progression
- Affects: Enemy wave size, enemy strength, attack frequency
- Early game protection: No attacks until threat > minimum threshold

### 5. Research System

**Kept similar to original** - science pack consumption.

- Research labs consume science packs over time
- Completing research unlocks new buildings
- Tech tree provides progression structure

---

## UI Structure (4 Tabs)

### Tab 1: Buildings
- List all building types by category
- Show: Count owned, production rate, cost to build
- Click to build (if resources available)
- No building management - just counts

```
=== SMELTERS ===
[furnace-iron-plate] x5  |  +10 iron-plate/sec  |  Build: 5 stone, 1 space
[furnace-copper-plate] x3  |  +6 copper-plate/sec  |  Build: 5 stone, 1 space
```

### Tab 2: Resources
- Show all resources with current/max
- **Net rate breakdown:** `(+Production - Consumption = Net)` with color coding
  - Green for positive net
  - Red for negative net
- Storage upgrade button per resource

```
Iron Plate: 1,234 / 2,000  (+10 - 0 = +10/sec)  [+Storage]
                                    ↑ GREEN
Energy: 450 / 500  (+50 - 45 = +5/sec)  [+Storage]
                            ↑ GREEN
Coal: 89 / 200  (+5 - 8 = -3/sec)  [+Storage]
                        ↑ RED
Space: 18 / 25 used
```

### Tab 3: Battle
- Threat level and timer display
- Player units list (ordered)
- Enemy units list (during combat)
- Base health
- Combat log

```
Threat Level: 3  |  Next Wave: 0:45
Base Health: ████████░░ 800/1000

YOUR FORCES (front to back):
1. Gun Drones x10 (HP: 500)
2. Basic Turrets x5 (HP: 300)
3. [BASE]

INCOMING: None (waiting for wave)
```

### Tab 4: Research
- Tech tree display
- Current research progress
- Science pack inventory

---

## Data Structures

### Game State
```javascript
gameState = {
  resources: {
    "iron-ore": { current: 100, max: 500 },
    "iron-plate": { current: 50, max: 200 },
    "energy": { current: 100, max: 500 },
    "space": { used: 15, max: 20 }
  },
  buildings: {
    "miner-iron": 3,
    "furnace-iron-plate": 5,
    "generator-coal": 2,
    "expander": 2
  },
  base: {
    hp: 1000,
    maxHp: 1000,
    energyGeneration: 10  // passive energy/sec, upgradeable via tech
  },
  combat: {
    playerUnits: [
      { type: "drone-gun", count: 10, hp: 500, maxHp: 500 },
      { type: "turret-basic", count: 5, hp: 300, maxHp: 300 }
    ]
  },
  threat: {
    level: 3,
    timer: 45,  // seconds until next wave
    minThreshold: 2  // no attacks below this
  },
  research: {
    current: "automation-2",
    progress: 0.45,
    completed: ["automation-1", "smelting-1"]
  }
}
```

### Building Definition
```javascript
{
  "furnace-iron-plate": {
    id: "furnace-iron-plate",
    name: "Iron Smelter",
    category: "smelting",
    spaceCost: 1,
    buildCost: { "stone": 5, "iron-plate": 2 },
    consumes: { "iron-ore": 1, "energy": 2 },
    produces: { "iron-plate": 1 },
    cycleTime: 0.5,  // seconds
    requiresTech: null
  }
}
```

---

## Implementation Phases

### Phase 1: Strip Down (Remove old systems)
- [ ] Remove region/map system
- [ ] Remove per-region building placement
- [ ] Remove recipe selection from buildings
- [ ] Remove combat initiation (player-triggered attacks)
- [ ] Simplify game state structure

### Phase 2: Core Resource Loop
- [ ] Implement Space as resource
- [ ] Convert buildings to count-based
- [ ] Create single-function building definitions
- [ ] Implement unified production loop (0.5s tick)
- [ ] Energy as standard resource

### Phase 3: New Building System
- [ ] Create all building type definitions
- [ ] Implement build/count system
- [ ] Add Expander buildings
- [ ] Implement threat level calculation

### Phase 4: Combat System
- [ ] Create ordered unit list structure
- [ ] Implement threat timer
- [ ] Implement wave spawning
- [ ] Implement ordered combat resolution
- [ ] Implement Game Over condition

### Phase 5: UI Overhaul
- [ ] New 4-tab structure (Buildings, Resources, Battle, Research)
- [ ] Buildings tab with categories and counts
- [ ] Resources tab with storage upgrades
- [ ] Battle tab with unit list and threat display
- [ ] Research tab (adapt existing)

### Phase 6: Balance & Polish
- [ ] Tune production rates
- [ ] Balance threat scaling
- [ ] Tune combat numbers
- [ ] Add number formatting (K, M, B)
- [ ] Satisfying idle feel

---

## File Changes Required

| File | Changes |
|------|---------|
| `data.json` | Complete rewrite - new building/resource structure |
| `game.js` | Major rewrite - new game loop, combat, UI |
| `index.html` | Restructure for 4 tabs |
| `style.css` | Simplify, adapt to new UI |

---

## Success Metrics

1. **Idle Feel:** Numbers visibly growing without constant clicking
2. **Simple Gameplay:** One click to build, watch numbers increase
3. **Meaningful Tension:** Threat system provides stakes without stress
4. **Clear Progression:** Stronger over time, more buildings, bigger numbers
5. **No Micromanagement:** No recipe selection, no region switching, no unit control

---

*Plan finalized. Ready to begin implementation.*

---

## Addendum (2026-01-18)

Three additional decisions incorporated:

### 1. Energy Safety Net
- **Base** building provides permanent passive `+10 Energy/sec`
- Prevents death spirals (zero energy → can't mine coal → stuck)
- Upgradeable via "Core Reactor Efficiency" technology
- System can always slowly restart itself

### 2. Active Play Focus
- No offline/AFK progression in first version
- Game requires browser window to be open
- Balance for active session pacing (faster ticks)
- "Safe Mode" is low priority

### 3. Resource UI Net Rate Breakdown
- Format: `(+Production - Consumption = Net)`
- Color coding: Green for positive, Red for negative
- Essential for player to balance ratios without mental math
