# 《扩张前线》战斗系统设计文档

**版本：** 1.0  
**日期：** 2024-11-30  
**文档类型：** 战斗系统详细设计

---

## 一、核心机制

### 1.1 编队系统

#### 格子机制
战斗采用**编队格子**系统，双方各自排列成队列，按顺序对战。

```
我方编队：
[格子1] → [格子2] → [格子3] → [格子4] → [格子5]
  ↓受攻击    待命      待命      待命      待命

敌方编队：
[格子1] → [格子2] → [格子3]
  ↓受攻击    待命      待命
```

**核心规则：**
- 双方所有单位**集火对方格子1**
- 格子1被消灭后，队列自动前进
- 重复直到一方全灭

#### 格子数量（指挥科技）
```
基础指挥    → 3个格子
高级指挥 I  → 5个格子
高级指挥 II → 7个格子
超级指挥    → 10个格子
终极指挥    → 15个格子
```

#### 格子容量规则
```
普通单位（小型）：最多10个/格
- 机枪无人机
- 重机枪无人机
- 小型工虫
- 中型战虫

中型单位：最多5个/格
- 喷火无人机
- 激光无人机
- 装甲甲虫
- 快速猎虫

大型单位：最多3个/格
- 炮台无人机
- 重型坦克虫

超大型单位：独占1格
- BOSS单位
- 精英虫王
```

#### 编队规则
- ✅ **同种单位可分格**：10个机枪可分成 [5个] + [5个]
- ⚠️ **但不推荐**：多打少很吃亏，火力分散容易被逐个击破
- ✅ **玩家可拖拽调整格子顺序**：肉盾在前，输出在后

**编队示例：**
```
肉盾流：
[格子1: 炮台×1]  → [格子2: 重机枪×10] → [格子3: 激光×10]
   ↑高血量吸收伤害      中坚力量            后排输出

速攻流：
[格子1: 激光×10] → [格子2: 激光×10]  → [格子3: 机枪×10]
   ↑快速清场            快速清场            补充火力

针对流（打装甲虫）：
[格子1: 重机枪×10] → [格子2: 重机枪×10] → [格子3: 炮台×1]
   ↑穿甲专精              穿甲专精            BOSS杀手
```

---

### 1.2 战斗流程

#### 实时战斗机制
```
战斗采用实时制，不是回合制：
- 每个单位有自己的攻击间隔（0.5秒 - 3秒）
- 所有单位独立攻击，同时进行
- 目标：当前对方队首格子
- 伤害实时结算，血条实时变化
```

#### 攻击间隔与DPS
```
机枪无人机：
- 攻击间隔：1.0秒
- 单次伤害：20
- DPS：20

重机枪无人机：
- 攻击间隔：1.5秒
- 单次伤害：40
- DPS：27（对装甲×2 = 54 DPS）

喷火无人机：
- 攻击间隔：2.0秒
- 单次伤害：30（AOE 3目标）
- DPS：15 × 3目标 = 45 总DPS

激光无人机：
- 攻击间隔：2.0秒
- 单次伤害：50
- DPS：25（对护盾×2 = 50 DPS）

炮台无人机：
- 攻击间隔：3.0秒
- 单次伤害：200
- DPS：67（对BOSS×1.5 = 100 DPS）
```

#### 伤害计算公式
```
实际伤害 = 基础伤害 × 克制倍率 × (1 - 防御率)

示例1：
10个重机枪无人机 vs 装甲甲虫（防御50%）
单次伤害 = 40 × 2.0（穿甲克制） × (1 - 0.5)
         = 40
总DPS = 40 / 1.5秒 × 10个
      = 267 DPS

示例2：
5个激光无人机 vs 能量护盾虫（物理-70%，激光克制×2）
单次伤害 = 50 × 2.0（激光克制）
         = 100（激光无视护盾）
总DPS = 100 / 2.0秒 × 5个
      = 250 DPS
```

#### 战斗结束条件
```
胜利：敌方所有格子被清空
失败：我方所有格子被清空
```

---

## 二、资源消耗系统

### 2.1 弹药消耗（纯弹药流）

**设计原则：所有武器都消耗弹药，不消耗电力**

#### 弹药类型与消耗
```
普通子弹：
- 使用单位：机枪无人机
- 消耗：1发/次攻击
- 生产：[军工厂] 铁板×1 → 普通子弹×10（1秒）

穿甲弹：
- 使用单位：重机枪无人机
- 消耗：1发/次攻击
- 生产：[军工厂] 铁板×2 + 钢板×1 → 穿甲弹×5（2秒）

轻油：
- 使用单位：喷火无人机
- 消耗：2单位/次攻击
- 生产：[化工厂] 原油×10 → 轻油×5（3秒）

能量弹：
- 使用单位：激光无人机
- 消耗：1发/次攻击
- 生产：[组装机] 电池×1 + 铁板×2 → 能量弹×10（2秒）

核弹头：
- 使用单位：炮台无人机
- 消耗：0.33发/次攻击（即3次攻击消耗1个）
- 生产：[重型军工厂] 铀235×1 + 炸药×10 → 核弹头×1（30秒）
```

#### 战斗前弹药检查
```
战前准备界面会显示：
✓ 普通子弹：500/100（充足）
✓ 穿甲弹：300/50（充足）
✗ 能量弹：20/200（不足！）⚠️

建议：
- 绿色✓：弹药充足，可安全作战
- 黄色⚠️：弹药紧张，可能中途耗尽
- 红色✗：弹药严重不足，必须补充
```

#### 弹药耗尽后果
```
某种弹药耗尽：
- 使用该弹药的无人机停止攻击
- 不会撤退，继续在场上
- 只能承受伤害，无法输出

示例：
激光无人机×10在战斗
能量弹从200 → 0
→ 激光无人机停止攻击
→ 只剩机枪无人机在输出
→ 可能导致战败
```

---

### 2.2 能量弹生产链

**设计目的：激光流依然需要复杂的生产链**

```
能量弹生产链：

[采矿] 铜矿 → 铜板
       ↓
[化工] 铜板 + 硫酸 + 铁板 → 电池
       ↓
[组装] 电池 + 铁板 → 能量弹×10

完整依赖：
- 铜矿 → 铜板
- 硫 + 水 → 硫酸
- 铁矿 → 铁板
- 化工厂（电池生产）
- 组装机（能量弹组装）

→ 激光流并不比弹药流简单
→ 保持生产链深度
```

---

## 三、单位系统

### 3.1 无人机属性

#### 机枪无人机
```
建造成本：铁板×5，电路板×2
建造时间：10秒
仓库占用：10

战斗属性：
- 生命值：100
- 防御：0%
- 攻击间隔：1.0秒
- 单次伤害：20
- DPS：20
- 弹药消耗：普通子弹×1/次
- 特性：通用型，无克制

定位：早期主力，成本低廉
```

#### 重机枪无人机
```
建造成本：钢板×10，电路板×5
建造时间：15秒
仓库占用：15

战斗属性：
- 生命值：200
- 防御：10%
- 攻击间隔：1.5秒
- 单次伤害：40
- DPS：27（对装甲×2 = 54）
- 弹药消耗：穿甲弹×1/次
- 特性：对装甲虫200%效率

定位：装甲克星，中期主力
```

#### 喷火无人机
```
建造成本：钢板×15，电路板×10，化工设备×5
建造时间：20秒
仓库占用：20

战斗属性：
- 生命值：150
- 防御：5%
- 攻击间隔：2.0秒
- 单次伤害：30（范围攻击3目标）
- DPS：45（总计）
- 弹药消耗：轻油×2/次
- 特性：对群体150%效率，AOE伤害

定位：虫海克星，群体控制
```

#### 激光无人机
```
建造成本：钢板×30，高级电路板×15，电池×10
建造时间：25秒
仓库占用：20

战斗属性：
- 生命值：150
- 防御：5%
- 攻击间隔：2.0秒
- 单次伤害：50
- DPS：25（对护盾×2 = 50）
- 弹药消耗：能量弹×1/次
- 特性：对护盾虫200%效率，无视物理护盾

定位：护盾克星，后期主力
```

#### 炮台无人机
```
建造成本：钢板×50，高级电路板×30，铀燃料棒×1
建造时间：40秒
仓库占用：50

战斗属性：
- 生命值：500
- 防御：30%
- 攻击间隔：3.0秒
- 单次伤害：200
- DPS：67（对BOSS×1.5 = 100）
- 弹药消耗：核弹头×0.33/次
- 特性：对BOSS 150%效率，超高单体伤害

定位：BOSS杀手，超级单位
```

---

### 3.2 虫族属性

#### 基础虫族（阶段1）

**小型工虫**
```
生命值：50
攻击：10
防御：0%
攻击间隔：1.5秒
DPS：7
特性：无
数量：通常10-20只
```

**中型战虫**
```
生命值：100
攻击：20
防御：0%
攻击间隔：1.5秒
DPS：13
特性：无
数量：通常5-10只
```

**装甲甲虫**
```
生命值：200
攻击：15
防御：50%（物理伤害减半）
攻击间隔：2.0秒
DPS：8
特性：护甲50%
克制：穿甲弹（重机枪无人机）
数量：通常3-5只
```

#### 进化虫族（阶段2）

**快速猎虫**
```
生命值：80
攻击：25
防御：0%
闪避：30%（30%几率完全闪避）
攻击间隔：1.0秒
DPS：25
特性：闪避30%
克制：范围武器（喷火无人机）
数量：通常5-8只
```

**能量护盾虫**
```
生命值：150
攻击：20
防御：0%
能量护盾：物理伤害-70%
攻击间隔：1.5秒
DPS：13
特性：能量护盾（物理武器效率-70%）
克制：激光武器（激光无人机）
数量：通常3-5只
```

#### 高级虫族（阶段3-4）

**重型坦克虫**
```
生命值：500
攻击：40
防御：70%
攻击间隔：2.5秒
DPS：16
特性：超高护甲
克制：穿甲弹 + 激光组合
数量：通常1-3只
```

**孵化母虫**
```
生命值：300
攻击：10
防御：20%
攻击间隔：2.0秒
DPS：5
特性：每20秒召唤小型工虫×5（后期添加）
威胁：优先击杀目标
数量：通常1只
```

**精英虫王**
```
生命值：800
攻击：60
防御：30%
全属性抗性：30%
攻击间隔：2.0秒
DPS：30
特性：全属性抗性30%
稀有：10%概率出现
数量：通常1只（独占一格）
```

---

### 3.3 BOSS单位

#### BOSS设计原则
- **独占一格**：BOSS永远单独占据一个格子
- **超高属性**：血量和攻击力远超普通单位
- **针对性**：需要特定武器克制
- **分阶段实现**：初版先做基础属性，后期添加特殊技能

#### BOSS 5：装甲巨虫
```
出现区域：区域5
独占格子：是

基础属性：
- 生命值：3000
- 攻击：50
- 防御：80%（必须穿甲弹）
- 攻击间隔：2.0秒
- DPS：25（但玩家受到的伤害很高）

克制方案：
- 重机枪无人机×20（穿甲弹流）
- 预计战斗时长：60-90秒
- 推荐弹药储备：穿甲弹×500

特殊技能（后期添加）：
- 无（初版）
```

#### BOSS 10：能量核心虫
```
出现区域：区域10
独占格子：是

基础属性：
- 生命值：5000
- 攻击：60
- 能量护盾：物理伤害-70%
- 攻击间隔：2.5秒
- DPS：24

克制方案：
- 激光无人机×30（激光流）
- 预计战斗时长：80-120秒
- 推荐弹药储备：能量弹×800

特殊技能（后期添加）：
- 周期性护盾强化（物理免疫5秒）
```

#### BOSS 15：虫巢母体
```
出现区域：区域15
独占格子：是

基础属性：
- 生命值：8000
- 攻击：40
- 防御：30%
- 攻击间隔：3.0秒
- DPS：13

克制方案：
- 混合编队（重机枪+激光+炮台）
- 预计战斗时长：120-180秒
- 推荐弹药储备：全类型×1000

特殊技能（后期添加）：
- 每20秒召唤随机虫族×5
- 持久战，考验弹药储备
```

#### BOSS 20：虫族主宰
```
出现区域：区域20
独占格子：是
多阶段：是

阶段1：装甲形态
- 生命值：10000
- 攻击：80
- 防御：90%
- 需要：穿甲弹流

阶段2：能量形态
- 生命值：8000
- 攻击：100
- 能量护盾：物理免疫
- 需要：激光流

阶段3：狂暴形态
- 生命值：5000
- 攻击：150
- 召唤：每回合召唤所有类型虫族
- 需要：炮台流 + 高DPS

克制方案：
- 超级混合编队
- 预计战斗时长：300-600秒
- 推荐弹药储备：全类型×3000+

特殊技能（后期添加）：
- 阶段转换时全体召唤
- 狂暴状态AOE伤害
```

---

## 四、修理与恢复系统

### 4.1 修理包机制

#### 修理包配方
```
[组装机] 铁板×5 + 钢板×2 → 修理包×1（5秒）

特点：
- 成本不高，鼓励大量生产
- 生产速度适中
- 可提前储备
```

#### 战斗中使用
```
使用条件：
- 目标：当前正在战斗的格子（格子1）
- 效果：该格子所有单位恢复固定HP
- 冷却：使用后10秒才能再次使用
- 消耗：1个修理包

恢复量（按单位类型）：
- 机枪无人机：+50 HP（50%）
- 重机枪无人机：+100 HP（50%）
- 喷火无人机：+75 HP（50%）
- 激光无人机：+75 HP（50%）
- 炮台无人机：+200 HP（40%）

设计理念：
- 固定HP恢复，不是百分比
- 小型单位恢复效率高
- 大型单位恢复效率相对低
- 不能无脑堆修理包（冷却限制）
```

#### 战斗中使用时机
```
推荐使用时机：
✓ 格子1血量低于30%
✓ 即将被消灭但还能撑10秒
✓ 高价值单位（激光、炮台）受损

不推荐使用时机：
✗ 格子1满血或轻微受损
✗ 格子1即将被秒杀（<5秒）
✗ 低价值单位（机枪）受损

战术意义：
- 延长前排生存时间
- 保护高价值单位
- 需要精准判断时机
```

---

### 4.2 战斗外修理

#### 战斗结束后状态
```
战斗胜利后：
- 受损无人机保留当前HP
- 可选择修理或拆解
- 不会自动恢复

示例：
战斗结束：
- 机枪无人机×8（血量60%，HP=60/100）
- 激光无人机×3（血量40%，HP=60/150）
- 炮台无人机×1（血量80%，HP=400/500）
```

#### 修理选项
```
选项1：消耗修理包修复
[修理全部]
- 消耗：修理包×3
- 效果：所有单位恢复到100%
- 推荐：修理包便宜，直接修

选项2：拆解报废
[拆解×3个激光无人机]
- 回收：钢板×15，高级电路×7，电池×5（50%返还）
- 效果：单位消失
- 推荐：严重受损且资源紧张时

选项3：保持现状
[不修理]
- 消耗：无
- 效果：下次战斗带伤上阵
- 风险：前排容易被快速击破
```

#### 修理包消耗计算
```
修理1个单位 = 1个修理包
与单位大小无关

示例：
修理机枪×8 = 8个修理包
修理炮台×1 = 1个修理包

设计理念：
- 简化计算
- 鼓励修理而非拆解
- 大型单位修理更划算
```

---

## 五、撤退系统

### 5.1 撤退机制

#### 撤退时间
```
撤退时间根据区域难度递增：

区域 1-5：  15秒
区域 6-10： 20秒
区域 11-15：25秒
区域 16-19：30秒
BOSS战：   40秒

设计理念：
- 早期容易撤退
- 后期撤退代价高
- BOSS战撤退风险巨大
```

#### 撤退流程
```
1. 战斗中点击[撤退]按钮
2. 倒计时开始（屏幕显示倒计时）
3. 我方停止攻击（无法操作）
4. 敌方继续免费攻击我方
5. 倒计时结束 → 撤退成功

撤退界面示意：
========================================
⚠️ 正在撤退... 12秒
我方停止攻击，敌方继续进攻！

【我方】                    【敌方】
格子1: 机枪×5              格子1: 战虫×6
███░░░░░░░ 30%  (撤退中)    ██████████ 正在攻击！
正在承受伤害...

[无法操作] 请等待撤退完成
========================================
```

#### 撤退结果
```
撤退成功：
✓ 保留剩余无人机（含受损）
✓ 保留50%剩余弹药
✗ 区域未占领
✗ 无额外惩罚（可立即再战）

示例：
撤退时剩余：
- 机枪×5（受损）
- 激光×3（受损）
- 子弹×200
- 能量弹×100

撤退后：
- 机枪×5（受损，保留）
- 激光×3（受损，保留）
- 子弹×100（损失50%）
- 能量弹×50（损失50%）

可以：
1. 修理后再战
2. 补充弹药后再战
3. 重新编队后再战
```

#### 撤退时机判断
```
推荐撤退：
✓ 前排即将崩溃（<20%血量）
✓ 弹药即将耗尽
✓ 发现配置错误（克制关系不对）
✓ 修理包已用完

不推荐撤退：
✗ 敌方只剩最后一格
✗ 我方输出足够（能在撤退时间内击杀）
✗ 高价值单位（炮台）已损失
```

---

### 5.2 撤退与失败

#### 撤退失败（被打死）
```
如果撤退期间全灭：
= 等同于战斗失败

损失：
- 所有参战无人机
- 所有剩余弹药
- 区域未占领

但是：
✓ 不需要读档
✓ 可以重新生产
✓ 可以再次挑战
```

#### 战斗失败处理
```
战斗失败 = 无人机全灭

损失：
- 所有参战无人机
- 所有携带弹药

保留：
✓ 所有建筑
✓ 所有已占领区域
✓ 所有仓库资源
✓ 所有科技

接下来：
1. 返回任意已占领区域
2. 重新生产无人机和弹药
3. 调整配置和编队
4. 再次挑战

→ 失败不致命
→ 只是进度受挫
→ 鼓励"稳扎稳打"
```

#### 防止死亡螺旋
```
设计保障：
✓ 矿脉永不枯竭（最低20%效率）
✓ 可以回到旧区域挖矿
✓ 允许"佛系挂机慢慢积累"
✓ 建筑可以拆除重建（100%返还）

→ 理论上不会真正卡死
→ 但效率极低会很慢
→ 鼓励"高效推进"而非"无脑莽"
```

---

## 六、战斗UI设计

### 6.1 战前准备界面

```
========================================
       准备进攻区域 8
========================================
【侦查报告】
敌方编队：
[格子1: 中型战虫×10]  血量：1000  攻击：200 DPS
[格子2: 装甲甲虫×5]   血量：1000  攻击：75 DPS
[格子3: 快速猎虫×8]   血量：640   攻击：200 DPS

总计：血量2640  攻击475 DPS

💡 威胁分析：
- 装甲甲虫需要穿甲弹克制
- 快速猎虫闪避30%，范围武器有效

----------------------------------------
【我方编队】拖拽调整顺序 👆

[格子1: 机枪无人机×10] ⬆️⬇️ 拖动排序
├ 血量：1000 (10×100)
├ 攻击：200 DPS
└ 弹药：普通子弹×1/秒

[格子2: 重机枪无人机×5] ⬆️⬇️
├ 血量：1000 (5×200)
├ 攻击：135 DPS（对装甲270 DPS）
└ 弹药：穿甲弹×0.7/秒

[格子3: 激光无人机×5] ⬆️⬇️
├ 血量：750 (5×150)
├ 攻击：125 DPS
└ 弹药：能量弹×0.5/秒

总计：血量2750  攻击460 DPS（含克制）

💡 建议：将重机枪放在前排（对装甲虫有效）

[交换格子1和格子2]

----------------------------------------
【资源检查】
✓ 普通子弹：500/200（充足）
✓ 穿甲弹：300/100（充足）
✓ 能量弹：200/50（充足）
✓ 修理包：10

----------------------------------------
【战斗预测】
预计时长：45-60秒
预计弹药消耗：
- 子弹：200发
- 穿甲弹：100发
- 能量弹：50发

撤退时间：20秒
胜率：82% 📊

[确认进攻] [调整编队] [生产弹药] [返回]
========================================
```

---

### 6.2 实时战斗界面

```
========================================
          区域 8 战斗中
========================================
战斗时长: 23秒 / 预计45秒

【我方】                    【敌方】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

格子1: 机枪无人机×10       格子1: 中型战虫×8
█████████░ 90%  ⚔️          ████░░░░░░ 40%  ⚔️
HP: 900/1000                HP: 400/1000
正在集火 →                  ← 正在反击
DPS: 200                    DPS: 160

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

格子2: 重机枪无人机×5      格子2: 装甲甲虫×5
██████████ 100% (待命)      ██████████ 100% (待命)
HP: 1000/1000               HP: 1000/1000

格子3: 激光无人机×5        格子3: 快速猎虫×8
██████████ 100% (待命)      ██████████ 100% (待命)
HP: 750/750                 HP: 640/640

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【弹药消耗】
子弹: 450/500 ████████░░
穿甲弹: 300/300 ██████████
能量弹: 200/200 ██████████

【修理包】 ×10
[使用修理包] (冷却: 5秒)
恢复格子1所有单位固定HP

【撤退】
撤退时间: 20秒
撤退期间敌方继续攻击！
[开始撤退]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【战斗日志】（最新5条）
[12:36] 中型战虫×2被击毁！剩余×8
[12:37] ⚠️ 格子1机枪无人机损失2架！剩余×8
[12:38] 机枪无人机×8攻击，造成160伤害
[12:39] 中型战虫×8反击，造成128伤害
[12:40] 中型战虫×1被击毁！剩余×7

[展开完整日志]

========================================
```

---

### 6.3 战斗结算界面

```
========================================
         战斗胜利！
========================================
区域 8 已占领

【战果统计】
战斗时长：52秒
消灭敌人：23只

【我方损失】
机枪无人机：10 → 6（损失4架）
重机枪无人机：5 → 4（损失1架）
激光无人机：5 → 5（无损失）

【弹药消耗】
普通子弹：500 → 280（消耗220发）
穿甲弹：300 → 180（消耗120发）
能量弹：200 → 150（消耗50发）

【修理包使用】
使用：2个
剩余：8个

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【受损单位修理】
机枪无人机×6（平均血量50%，HP=50/100）
├ [消耗6个修理包] 全部修复
├ [拆解全部] 回收铁板×15 电路×6
└ [保持现状] 下次战斗带伤

重机枪无人机×4（平均血量70%，HP=140/200）
├ [消耗4个修理包] 全部修复
├ [拆解全部] 回收钢板×20 电路×10
└ [保持现状] 下次战斗带伤

💡 建议：修理包成本低，建议全部修复

[一键修复全部] [逐个选择] [继续]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【区域奖励】
✓ 解锁区域 8
✓ 新资源点：铁矿×1，铜矿×1
✓ 新槽位：+2（当前12个）

[查看区域] [继续推进] [返回基地]

========================================
```

---

### 6.4 战斗失败界面

```
========================================
         战斗失败
========================================
我方全军覆没！

【损失统计】
机枪无人机×10 - 全灭
重机枪无人机×5 - 全灭
激光无人机×5 - 全灭

弹药全部消耗

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【失败原因分析】
⚠️ 克制关系不对：装甲甲虫需要穿甲弹
⚠️ 弹药不足：能量弹在第30秒耗尽
💡 建议：增加重机枪无人机数量

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【接下来】
✓ 返回基地重新生产
✓ 所有建筑和资源保留
✓ 可以调整生产配置
✓ 矿脉继续产出（不会卡死）

[返回基地] [重新编队] [查看生产]

========================================
```

---

## 七、战术策略

### 7.1 编队策略

#### 肉盾流
```
编队配置：
[格子1: 炮台无人机×1]  ← 超高血量吸收伤害
[格子2: 重机枪×10]      ← 中坚火力
[格子3: 激光×10]        ← 后排输出

优点：
✓ 炮台血量500，能撑很久
✓ 后排安全输出
✓ 适合持久战

缺点：
✗ 前排火力不足（炮台DPS低）
✗ 敌方快速突破后，后排脆弱
✗ 炮台成本高，损失代价大

适用场景：
- BOSS战
- 敌方高攻击低血量
- 弹药充足的持久战
```

#### 速攻流
```
编队配置：
[格子1: 激光×10]   ← 高DPS快速清场
[格子2: 激光×10]   ← 高DPS快速清场
[格子3: 机枪×10]   ← 补充火力

优点：
✓ 快速清除敌方前排
✓ 缩短战斗时间
✓ 节省弹药（战斗短）

缺点：
✗ 前排血量不足（激光150HP）
✗ 能量弹消耗大
✗ 敌方高攻击时容易崩盘

适用场景：
- 敌方低攻击高血量
- 能量弹充足
- 追求快速通关
```

#### 针对流（装甲虫）
```
编队配置：
[格子1: 重机枪×10]  ← 穿甲专精
[格子2: 重机枪×10]  ← 穿甲专精
[格子3: 炮台×1]     ← BOSS/精英杀手

优点：
✓ 对装甲虫200%效率
✓ 快速击破装甲单位
✓ 炮台收尾

缺点：
✗ 对其他单位效率一般
✗ 穿甲弹消耗大
✗ 如果侦查错误，浪费资源

适用场景：
- 敌方大量装甲单位
- BOSS：装甲巨虫
- 穿甲弹储备充足
```

#### 群体流（虫海）
```
编队配置：
[格子1: 喷火×10]  ← AOE伤害
[格子2: 喷火×5]   ← AOE伤害
[格子3: 激光×5]   ← 单体收尾

优点：
✓ 对群体虫海效率高
✓ AOE快速清场
✓ 适合小型工虫×50这种

缺点：
✗ 对单体大型单位效率低
✗ 轻油消耗大
✗ 喷火血量一般

适用场景：
- 敌方小型单位×20+
- 虫海战术
- 轻油储备充足
```

---

### 7.2 战前准备策略

#### 侦查与针对
```
步骤1：侦查敌方编队
[格子1: 装甲甲虫×10] ← 主要威胁
[格子2: 中型战虫×5]
[格子3: 快速猎虫×3]

步骤2：分析克制关系
装甲甲虫 → 需要穿甲弹
快速猎虫 → 闪避高，范围武器有效

步骤3：针对性配置
我方编队：
[格子1: 重机枪×15] ← 针对装甲
[格子2: 喷火×5]    ← 针对快速猎虫
[格子3: 机枪×10]   ← 通用补充

步骤4：检查弹药
穿甲弹：500（充足）
轻油：100（充足）
子弹：500（充足）

步骤5：确认进攻
预计胜率：95%
```

#### 弹药准备
```
战前弹药储备建议：

小规模战斗（区域1-5）：
- 子弹×500
- 穿甲弹×200
- 修理包×5

中等规模战斗（区域6-10）：
- 子弹×1000
- 穿甲弹×500
- 能量弹×300
- 轻油×200
- 修理包×10

大规模战斗（区域11-15）：
- 子弹×2000
- 穿甲弹×1000
- 能量弹×800
- 轻油×500
- 核弹头×10
- 修理包×20

BOSS战（区域5, 10, 15, 20）：
- 对应克制弹药×2000
- 其他弹药×500（备用）
- 修理包×30

💡 原则：宁可多备，不要不足
```

#### 修理包使用策略
```
何时使用修理包：

推荐使用：
✓ 格子1血量<30%
✓ 高价值单位（激光、炮台）受损
✓ 即将被击破但能撑过冷却时间
✓ BOSS战后期

不推荐使用：
✗ 格子1满血
✗ 低价值单位（机枪）轻微受损
✗ 即将被秒杀（<3秒）
✗ 修理包即将耗尽

节约技巧：
- 等格子1血量<50%再用
- 优先修理大型单位（恢复效率高）
- 保留至少5个修理包应急
```

---

### 7.3 撤退判断

#### 何时应该撤退
```
推荐撤退场景：

场景1：克制关系错误
敌方：能量护盾虫×10
我方：机枪×20（物理伤害-70%）
→ 立即撤退，重新配置激光流

场景2：弹药即将耗尽
能量弹：20/200（剩余10秒）
敌方：还剩2格
→ 撤退，补充弹药后再战

场景3：前排即将崩溃
格子1：机枪×3（血量15%）
格子2：激光×5（脆弱）
修理包：已用完
→ 撤退，保护后排单位

场景4：发现编队失误
格子1：激光×10（血量30%）
敌方：攻击太高
→ 撤退，调整为肉盾在前

场景5：意外情况
敌方出现精英虫王（未侦查到）
我方配置不足
→ 撤退，重新准备
```

#### 何时不应该撤退
```
不推荐撤退场景：

场景1：即将胜利
敌方：只剩最后1格，血量20%
我方：格子1血量50%
→ 坚持，能在撤退时间内击杀

场景2：撤退代价太高
我方：炮台×1已损失（成本高）
敌方：还剩很多
→ 撤退损失已发生，不如拼一把

场景3：BOSS战后期
BOSS：最后阶段，血量10%
我方：编队崩溃
→ BOSS撤退时间40秒，不如拼到底

场景4：有修理包支撑
格子1：血量30%
修理包：×10
→ 用修理包撑住，不需要撤退
```

---

## 八、平衡性设计

### 8.1 数值平衡目标

#### 战斗时长目标
```
区域 1-5：  30-60秒
区域 6-10： 45-90秒
区域 11-15：60-120秒
区域 16-19：90-150秒
BOSS战：   120-300秒

设计目标：
- 不要太快（无聊）
- 不要太慢（拖沓）
- 给玩家足够决策时间
```

#### 弹药消耗平衡
```
单次战斗弹药消耗目标：

早期：消耗30-50%储备
中期：消耗40-60%储备
后期：消耗50-70%储备
BOSS：消耗60-80%储备

设计目标：
- 鼓励准备充分
- 避免无脑堆弹药
- 失败惩罚明显但不致命
```

#### 单位性价比
```
目标：所有单位都有使用场景

机枪无人机：
- 性价比：★★★★★
- 场景：早期主力，通用

重机枪无人机：
- 性价比：★★★★☆（对装甲）
- 性价比：★★★☆☆（对其他）
- 场景：装甲克星

喷火无人机：
- 性价比：★★★★★（对虫海）
- 性价比：★★☆☆☆（对单体）
- 场景：群体克星

激光无人机：
- 性价比：★★★★☆
- 场景：后期主力，护盾克星

炮台无人机：
- 性价比：★★★★★（对BOSS）
- 性价比：★★★☆☆（对小兵）
- 场景：BOSS战，精英单位
```

---

### 8.2 克制关系平衡

#### 克制倍率设计
```
强克制：2.0倍（200%）
- 穿甲弹 vs 装甲
- 激光 vs 护盾
- 范围武器 vs 虫海

中等克制：1.5倍（150%）
- 炮台 vs BOSS
- 喷火 vs 群体

无克制：1.0倍（100%）
- 通用伤害

被克制：0.5倍（50%）
- 物理 vs 装甲（无穿甲）
- 物理 vs 护盾
- 单体 vs 闪避

设计目标：
- 克制关系明显但不绝对
- 通用流依然可行（效率低）
- 鼓励针对性配置
```

#### 防御机制平衡
```
护甲类型：

低防：0-10%
- 小型单位
- 速度快，血量低

中防：20-30%
- 中型单位
- 平衡型

高防：50-70%
- 装甲单位
- 必须穿甲弹

超高防：80-90%
- BOSS单位
- 强制针对性配置

能量护盾：
- 物理伤害-70%
- 激光伤害正常
- 强制激光流
```

---

### 8.3 测试检查点

#### 战斗平衡测试
```
测试项目1：单位平衡性
- 机枪 vs 重机枪 vs 激光
- 是否所有单位都有使用价值
- 后期是否完全淘汰早期单位

测试项目2：克制关系
- 克制倍率是否明显
- 无克制流是否完全不可行
- 针对流是否过于强势

测试项目3：战斗时长
- 是否符合目标时长
- 是否太快或太慢
- BOSS战是否过于漫长

测试项目4：弹药消耗
- 单次战斗消耗是否合理
- 是否需要频繁补充
- 储备量是否足够

测试项目5：修理包效果
- 恢复量是否合适
- 冷却时间是否合理
- 是否会被无脑堆修理包

测试项目6：撤退机制
- 撤退时间是否合理
- 撤退期间损失是否过大
- 是否会被滥用（无脑撤退）
```

#### 数值调整方向
```
如果战斗太快：
→ 提高敌方血量10-20%
→ 降低我方DPS 10-20%

如果战斗太慢：
→ 降低敌方血量10-20%
→ 提高我方DPS 10-20%

如果某单位过强：
→ 提高成本20-30%
→ 降低DPS 10-15%
→ 降低血量10-15%

如果某单位过弱：
→ 降低成本20-30%
→ 提高DPS 10-15%
→ 提高血量10-15%

如果克制不明显：
→ 提高克制倍率（1.5 → 2.0）
→ 提高防御率（50% → 70%）

如果修理包过强：
→ 降低恢复量（50HP → 30HP）
→ 增加冷却时间（10秒 → 15秒）
```

---

## 九、开发实现

### 9.1 开发优先级

#### Phase 1：核心战斗（1-2周）
```
必须实现：
✓ 编队系统（UI + 逻辑）
✓ 拖拽排序
✓ 格子容量限制
✓ 实时战斗逻辑
  - 集火队首
  - 伤害计算
  - 血条更新
  - 队列前进
✓ 基础UI（战斗界面）
✓ 战斗日志

测试内容：
- 2种无人机（机枪、重机枪）
- 2种虫族（小型工虫、装甲甲虫）
- 简单战斗流程
```

#### Phase 2：完善机制（1周）
```
必须实现：
✓ 弹药消耗系统
  - 每次攻击扣除弹药
  - 弹药耗尽处理
✓ 修理包系统
  - 战斗中使用
  - 冷却计时
  - 固定HP恢复
✓ 撤退系统
  - 倒计时
  - 停止攻击
  - 撤退结算
✓ 战斗结算
  - 胜利界面
  - 失败界面
  - 受损修理

测试内容：
- 5种无人机
- 5种虫族
- 完整战斗流程
```

#### Phase 3：BOSS战（1周）
```
必须实现：
✓ BOSS独占格子
✓ BOSS高属性（血量、攻击、防御）
✓ 战前侦查（显示BOSS信息）
✓ 针对性配置提示

测试内容：
- BOSS 5：装甲巨虫
- 针对性编队测试
- 长时间战斗测试
```

#### Phase 4：打磨优化（持续）
```
优化项目：
✓ 数值平衡调整
✓ UI优化
  - 血条动画
  - 攻击特效
  - 战斗日志高亮
✓ 提示优化
  - 克制关系提示
  - 弹药不足警告
  - 胜率预测
✓ 音效（可选）
  - 攻击音效
  - 击杀音效
  - 胜利/失败音乐
```

---

### 9.2 测试工具设计

#### Debug战斗测试界面
```
========================================
        战斗测试工具（DEBUG）
========================================
【快速配置】

我方编队：
格子1: [选择单位 ▼] [数量: __] [添加]
格子2: [选择单位 ▼] [数量: __] [添加]
格子3: [选择单位 ▼] [数量: __] [添加]
格子4: [选择单位 ▼] [数量: __] [添加]
格子5: [选择单位 ▼] [数量: __] [添加]

单位选项：
- 机枪无人机
- 重机枪无人机
- 喷火无人机
- 激光无人机
- 炮台无人机

当前编队：
[机枪×10] [重机枪×5] [激光×5]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

敌方编队：
格子1: [选择虫族 ▼] [数量: __] [添加]
格子2: [选择虫族 ▼] [数量: __] [添加]
格子3: [选择虫族 ▼] [数量: __] [添加]

虫族选项：
- 小型工虫
- 中型战虫
- 装甲甲虫
- 快速猎虫
- 能量护盾虫
- 重型坦克虫
- BOSS：装甲巨虫

当前编队：
[装甲甲虫×10] [中型战虫×5]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【测试选项】
□ 无限弹药（测试伤害）
□ 无限修理包
□ 显示DPS数值
□ 显示实时伤害
□ 慢动作（0.5倍速）
□ 快进（2倍速 / 5倍速 / 10倍速）

【预设场景】
[场景1: 区域1标准战斗]
  我方：机枪×10
  敌方：小型工虫×10

[场景2: 区域5 BOSS战]
  我方：重机枪×20
  敌方：装甲巨虫×1

[场景3: 虫海测试]
  我方：喷火×10
  敌方：小型工虫×50

[场景4: 修理包压力测试]
  我方：机枪×5（低血量）
  敌方：中型战虫×20（高攻击）

[场景5: 撤退测试]
  我方：机枪×10
  敌方：装甲甲虫×20（克制我方）

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【数据导出】
战斗结果会自动记录到测试日志

[导出CSV] [查看历史] [清空记录]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[开始战斗] [重置配置] [返回]

========================================
```

#### 测试记录表
```
测试记录（CSV格式）：

日期,场景,我方编队,敌方编队,战斗时长,胜负,我方损失,弹药消耗,修理包使用,备注
2024-11-30,区域1,机枪×10,小型工虫×10,35秒,胜,2架,子弹×70,0个,平衡
2024-11-30,区域5,重机枪×20,装甲巨虫×1,98秒,胜,5架,穿甲弹×196,3个,偏难
2024-11-30,虫海,喷火×10,小型工虫×50,42秒,胜,1架,轻油×84,1个,平衡
...

用途：
- 分析战斗数据
- 调整数值平衡
- 发现异常情况
```

---

### 9.3 技术实现要点

#### 战斗逻辑伪代码
```javascript
// 战斗主循环
class Battle {
  constructor(myTeam, enemyTeam) {
    this.myTeam = myTeam;
    this.enemyTeam = enemyTeam;
    this.battleTime = 0;
    this.repairCooldown = 0;
  }

  // 每帧更新（60FPS）
  update(deltaTime) {
    this.battleTime += deltaTime;
    
    // 更新修理包冷却
    if (this.repairCooldown > 0) {
      this.repairCooldown -= deltaTime;
    }
    
    // 更新我方单位攻击
    for (let slot of this.myTeam.slots) {
      for (let unit of slot.units) {
        unit.attackCooldown -= deltaTime;
        
        if (unit.attackCooldown <= 0) {
          // 攻击敌方队首
          this.attack(unit, this.enemyTeam.firstSlot());
          unit.attackCooldown = unit.attackInterval;
        }
      }
    }
    
    // 更新敌方单位攻击
    for (let slot of this.enemyTeam.slots) {
      for (let unit of slot.units) {
        unit.attackCooldown -= deltaTime;
        
        if (unit.attackCooldown <= 0) {
          // 攻击我方队首
          this.attack(unit, this.myTeam.firstSlot());
          unit.attackCooldown = unit.attackInterval;
        }
      }
    }
    
    // 检查格子是否全灭
    this.checkSlotDestroyed(this.myTeam);
    this.checkSlotDestroyed(this.enemyTeam);
    
    // 检查战斗结束
    if (this.myTeam.isEmpty()) {
      this.onDefeat();
    } else if (this.enemyTeam.isEmpty()) {
      this.onVictory();
    }
  }
  
  // 攻击逻辑
  attack(attacker, targetSlot) {
    // 检查弹药
    if (!this.consumeAmmo(attacker)) {
      attacker.outOfAmmo = true;
      return;
    }
    
    // 计算伤害
    let damage = attacker.damage;
    damage *= this.getCounterMultiplier(attacker, targetSlot);
    damage *= (1 - targetSlot.firstUnit().defense);
    
    // 造成伤害
    targetSlot.firstUnit().hp -= damage;
    
    // 检查击杀
    if (targetSlot.firstUnit().hp <= 0) {
      targetSlot.removeFirstUnit();
    }
    
    // 战斗日志
    this.addLog(`${attacker.name} 攻击 ${targetSlot.name}，造成 ${damage} 伤害`);
  }
  
  // 使用修理包
  useRepairPack() {
    if (this.repairCooldown > 0) {
      return false; // 冷却中
    }
    
    let slot = this.myTeam.firstSlot();
    for (let unit of slot.units) {
      unit.hp += unit.getRepairAmount(); // 固定HP恢复
      unit.hp = Math.min(unit.hp, unit.maxHp);
    }
    
    this.repairCooldown = 10; // 10秒冷却
    this.addLog("使用修理包！");
    return true;
  }
  
  // 撤退逻辑
  retreat() {
    this.retreating = true;
    this.retreatTime = this.getRetreatTime();
    
    // 我方停止攻击
    this.myTeam.stopAttack();
    
    // 敌方继续攻击
    // （update循环中自动处理）
  }
}
```

---

## 十、总结

### 核心特点
✅ **编队系统**：格子队列，拖拽排序，战术深度  
✅ **实时战斗**：集火队首，简单清晰，易于理解  
✅ **纯弹药流**：统一资源管理，避免电力复杂性  
✅ **修理包机制**：固定HP恢复，冷却限制，战术使用  
✅ **撤退系统**：时间惩罚，风险判断，容错机制  
✅ **失败不致命**：重新生产，再次挑战，鼓励稳扎稳打

### 设计目标
- **简单清晰**：战斗逻辑一目了然
- **战术深度**：编队、克制、时机判断
- **平衡性**：所有单位有使用价值
- **容错性**：失败不致命，允许试错
- **可扩展**：BOSS技能、特殊机制后期添加

### 开发路线
1. **Phase 1**：核心战斗（编队+实时战斗）
2. **Phase 2**：完善机制（弹药+修理+撤退）
3. **Phase 3**：BOSS战（高属性+针对性）
4. **Phase 4**：打磨优化（数值+UI+测试）

---

**文档版本：** 1.0  
**创建日期：** 2024-11-30  
**最后更新：** 2024-11-30

---

*《扩张前线》战斗系统设计文档完成！*
