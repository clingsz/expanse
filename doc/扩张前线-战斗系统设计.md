# 《扩张前线》战斗系统设计文档
## Combat System Design Document

**版本：** 2.0  
**日期：** 2024-12-04

---

## 一、战斗机制概述

### 核心特性
- **实时自动战斗**：无需玩家操作，自动进行
- **智能目标锁定**：每个单位自动选择最优目标
- **兵种克制系统**：不同单位对不同敌人有伤害加成/减免
- **弹药消耗机制**：弹药耗尽单位停火

---

## 二、无人机单位属性

### 机枪无人机
```
攻击力：20
攻击间隔：1 秒
弹药消耗：普通子弹 × 1/次
血量：100
战力值：10

目标优先级：
- 血量最低的敌人（通用补刀）

克制关系：
- 对装甲虫：0.5× 伤害（被克制）
- 其他：1.0× 伤害
```

### 重机枪无人机
```
攻击力：40
攻击间隔：2 秒
弹药消耗：穿甲弹 × 1/次
血量：150
战力值：20

目标优先级：
1. 装甲虫（优先）
2. 其他目标

克制关系：
- 对装甲虫：2.0× 伤害
- 其他：1.0× 伤害
```

### 喷火无人机
```
攻击力：30（范围攻击）
攻击间隔：2.5 秒
弹药消耗：轻油 × 2/次
血量：120
战力值：25

目标优先级：
1. 小型虫群（场上小型虫 ≥3 只时优先）
2. 其他目标

克制关系：
- 对小型虫群：1.5× 伤害
- 可同时攻击 3 个相邻目标
- 对单体大型虫：0.8× 伤害
```

### 激光无人机
```
攻击力：50
攻击间隔：1.5 秒
弹药消耗：电池包 × 1/次
血量：120
战力值：30

目标优先级：
1. 护盾虫（优先）
2. 其他目标

克制关系：
- 对护盾虫：2.0× 伤害
- 其他：1.0× 伤害
```

### 等离子无人机
```
攻击力：70
攻击间隔：2 秒
弹药消耗：聚变电池 × 1/次
血量：150
战力值：40

目标优先级：
1. 血量最高的目标（优先）
2. 其他目标

特性：
- 穿透攻击，无视 30% 护甲
- 对高护甲目标：1.3× 伤害
```

### 炮台无人机
```
攻击力：200
攻击间隔：5 秒
弹药消耗：核弹头 × 0.2/次
血量：300
战力值：50

目标优先级：
1. BOSS/精英虫（最高优先）
2. 大型虫（重型坦克虫、孵化母虫）
3. 其他目标

克制关系：
- 对 BOSS/精英：1.5× 伤害
- 对小型虫：0.8× 伤害
```

---

## 三、虫族单位属性

### 基础虫族

**小型工虫**
```
血量：50
攻击力：10
攻击间隔：1.5 秒
战力值：5
特性：无
```

**中型战虫**
```
血量：100
攻击力：20
攻击间隔：2 秒
战力值：10
特性：无
```

**装甲甲虫**
```
血量：200
攻击力：15
攻击间隔：2.5 秒
战力值：30
特性：护甲 50%（普通物理伤害减半）
弱点：穿甲武器
```

### 进化虫族

**快速猎虫**
```
血量：80
攻击力：25
攻击间隔：1 秒
战力值：15
特性：闪避 30%（有几率闪避攻击）
弱点：范围武器
```

**能量护盾虫**
```
血量：150
攻击力：20
攻击间隔：2 秒
战力值：25
特性：能量护盾（普通物理武器 -50% 效率）
弱点：激光武器
```

### 高级虫族

**重型坦克虫**
```
血量：500
攻击力：40
攻击间隔：3 秒
战力值：60
特性：护甲 70%
```

**孵化母虫**
```
血量：300
攻击力：10
攻击间隔：2 秒
战力值：50
特性：每 10 秒召唤 2 只小型工虫
威胁等级：高（优先击杀）
```

**精英虫王**
```
血量：800
攻击力：60
攻击间隔：2.5 秒
战力值：80
特性：全属性抗性 30%
出现：稀有（10% 概率）
```

### BOSS 虫族

**BOSS 5：装甲巨虫**
```
血量：3000
攻击力：50
攻击间隔：3 秒
特性：护甲 80%
机制：必须用穿甲武器
```

**BOSS 10：能量核心虫**
```
血量：5000
攻击力：60
攻击间隔：2.5 秒
特性：能量护盾（物理伤害 -70%）
机制：几乎必须用激光
```

**BOSS 15：虫巢母体**
```
血量：8000
攻击力：40
攻击间隔：3 秒
特性：每 15 秒召唤随机虫族×5
机制：持久战，考验弹药储备
```

**BOSS 20：虫族主宰（三阶段）**
```
阶段 1：装甲形态
- 血量：10000
- 攻击力：80
- 特性：护甲 90%

阶段 2：能量形态
- 血量：8000
- 攻击力：70
- 特性：能量护盾 + 免疫物理伤害

阶段 3：狂暴形态
- 血量：5000
- 攻击力：100
- 特性：每 10 秒召唤所有类型虫族各×2
```

---

## 四、克制关系总表

| 无人机类型 | 克制目标 | 伤害倍率 | 被克制情况 |
|-----------|---------|---------|----------|
| 机枪无人机 | 无 | 1.0× | 对装甲虫 0.5× |
| 重机枪无人机 | 装甲虫 | 2.0× | 无 |
| 喷火无人机 | 小型虫群 | 1.5×（范围3个） | 对大型虫 0.8× |
| 激光无人机 | 护盾虫 | 2.0× | 无 |
| 等离子无人机 | 高护甲目标 | 1.3× | 无 |
| 炮台无人机 | BOSS/精英 | 1.5× | 对小型虫 0.8× |

---

## 五、战斗流程

### 阶段 1：进入战斗

玩家点击【开始战斗】后，直接进入战斗界面。

### 阶段 2：实时自动战斗

**战斗界面显示：**

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【战斗中】区域 8 - 自动进行中

血量对比：[████████████░░░░░░] 
我方：1850/2000        敌方：420/1500

━━━ 我方编队 ━━━       ━━━ 敌方 ━━━
重机枪×5 [▓▓▓▓▓]      装甲虫×1 [▓░░░]
激光×3   [▓▓▓▓▓]      护盾虫×3 [▓▓▓░]
机枪×8   [▓▓▓▓░]      工虫×7   [▓▓░░]

战斗效率：
我方 DPS：240/秒        敌方 DPS：180/秒

弹药消耗：
穿甲弹：-5/秒  [▓▓░░░] 180/500 ⚠️ (剩余 36 秒)
电池包：-2/秒  [▓▓▓▓▓] 450/500 (剩余 225 秒)
普通弹：-8/秒  [▓▓▓▓░] 1200/2000 (剩余 150 秒)

战斗时间：00:42

[撤退]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**实时计算逻辑：**

1. **目标锁定**
   - 每架无人机按照优先级自动锁定 1 个目标
   - 例：重机枪优先锁定装甲虫，激光优先锁定护盾虫
   - 目标死亡后立即切换到下一个符合优先级的目标

2. **攻击执行**
   - 每个单位按照攻击间隔独立攻击
   - 重机枪每 2 秒攻击一次，机枪每 1 秒攻击一次
   - 同时消耗对应弹药

3. **伤害计算**
   ```
   实际伤害 = 基础攻击力 × 克制倍率 × 目标减伤
   
   例子：
   重机枪（攻击 40）打装甲虫（护甲 50%）
   = 40 × 2.0（克制）× 0.5（护甲）
   = 40 实际伤害
   
   机枪（攻击 20）打装甲虫
   = 20 × 0.5（被克制）× 0.5（护甲）
   = 5 实际伤害
   ```

4. **弹药消耗**
   - 每次攻击消耗对应弹药
   - 弹药耗尽时，该单位停火（显示 🚫）
   - DPS 实时下降

5. **敌方反击**
   - 敌方单位同时对我方造成伤害
   - 优先攻击前排/高威胁单位

6. **单位死亡**
   - 血量归零立即死亡
   - 从列表中移除
   - 对方单位自动切换目标

### 阶段 3：战斗结算

**胜利条件：** 消灭所有敌方单位

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【胜利！】区域 8 已占领

━━━ 战斗统计 ━━━
战斗时长：1 分 28 秒
总伤害输出：21,120
总承受伤害：6,840

━━━ 单位表现 ━━━
🌟 重机枪×5
   击杀：装甲虫×2
   输出伤害：8,400（克制×2 生效）
   评价：★★★★★ MVP

🌟 激光×3
   击杀：护盾虫×3
   输出伤害：6,900（克制×2 生效）
   评价：★★★★☆ 优秀

📊 机枪×10 → 8（损失 2 架）
   击杀：工虫×15
   输出伤害：5,820
   承受伤害：6,840（主要承伤）
   评价：★★★☆☆ 合格

━━━ 资源消耗 ━━━
穿甲弹：-88
电池包：-124
普通弹：-350

[继续]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**失败条件：** 我方单位全灭

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【战败】

我方全军覆没

剩余敌军：
装甲虫×1，护盾虫×2，工虫×5

[返回基地]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 六、特殊机制

### 6.1 弹药耗尽

当某类弹药耗尽时：

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⚠️ 穿甲弹耗尽！

━━━ 我方编队 ━━━
重机枪×5 [停火 🚫]
激光×3   [▓▓▓▓░]
机枪×10  [▓▓▓░░]

我方 DPS：240/秒 → 160/秒（下降 33%）

⚠️ 战况不利，建议撤退！

[强行继续] [撤退]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**机制说明：**
- 依赖该弹药的单位立即停火
- 不再造成伤害，不再消耗弹药
- 但仍会被敌人攻击（成为肉盾）
- DPS 实时重新计算

### 6.2 撤退机制

**触发条件：** 玩家随时可以选择撤退

**撤退结果：**
- 保留所有剩余无人机
- 保留所有剩余弹药
- 敌方数量**完全恢复**到初始状态
- 可以随时重新进攻

**设计意图：**
- 鼓励玩家"试探性进攻"
- 但必须全副武装才能通关
- 撤退没有惩罚，但也没有进展

### 6.3 目标锁定详解

**自动分散机制：**

```
场景：5 架重机枪 vs 2 只装甲虫

自动锁定：
- 重机枪 1、2、3 → 装甲虫 A
- 重机枪 4、5 → 装甲虫 B

结果：
- 合理分配火力
- 避免过度集火浪费
```

**克制目标全灭后：**

```
场景：5 架重机枪消灭所有装甲虫后

自动切换：
- 克制加成消失
- 转向攻击其他目标（护盾虫/工虫）
- 变为普通伤害（1.0×）
```

**范围攻击（喷火无人机）：**

```
喷火无人机攻击时：
- 锁定主目标 1 个
- 同时对相邻 2 个目标造成伤害
- 伤害倍率：对小型虫 1.5×，对大型虫 0.8×

示例：
工虫群 10 只密集站位
喷火×2 攻击
- 喷火 A：攻击工虫 1、2、3（每个 45 伤害）
- 喷火 B：攻击工虫 4、5、6（每个 45 伤害）
- 每 2.5 秒清理 6 只工虫
```

### 6.4 BOSS 战特殊规则

**进入 BOSS 战：**
- 无法中途撤退
- 必须战斗到底

**BOSS 血条显示：**
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【BOSS 战】区域 20 - 虫族主宰

阶段 1：装甲形态
血量：[██████████░░] 10000/10000

阶段 2：能量形态（未解锁）
血量：[░░░░░░░░░░░░] 8000/8000

阶段 3：狂暴形态（未解锁）
血量：[░░░░░░░░░░░░] 5000/5000
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**阶段转换：**
```
阶段 1 血量清零 → 进入阶段 2
- 重置部分血量
- 改变战斗特性
- 可能召唤小怪

例：虫族主宰
- 阶段 1（装甲形态）→ 阶段 2（能量形态）
  需要改变战术（从穿甲武器切换到激光）
```

**BOSS 战失败：**
- 损失 50% 无人机
- 可重整旗鼓再战
- BOSS 血量完全恢复

---

## 七、战斗实例演示

### 实例 1：标准战斗

**初始配置：**
```
我方：
- 重机枪×5（穿甲弹 500）
- 激光×3（电池包 500）
- 机枪×10（普通弹 2000）

敌方：
- 装甲虫×2
- 护盾虫×3
- 工虫×15
```

**战斗进程：**

```
00:00 - 战斗开始
- 重机枪×5 锁定装甲虫×2
- 激光×3 锁定护盾虫×3
- 机枪×10 锁定工虫×15

00:08 - 装甲虫全灭
- 重机枪输出：40×2（克制）×5 = 400/回合
- 装甲虫血量：200×2 = 400
- 约 4 次攻击（8 秒）全灭

00:09 - 重机枪失去克制目标
- 转向攻击护盾虫（无克制加成）

00:18 - 护盾虫全灭
- 激光输出：50×2（克制）×3 = 300/1.5秒
- 重机枪辅助：40×5 = 200/2秒
- 护盾虫血量：150×3 = 450
- 约 10 秒全灭

00:35 - 工虫全灭
- 机枪输出：20×10 = 200/秒
- 工虫血量：50×15 = 750
- 支援火力到位后快速清理

结果：胜利
时长：35 秒
损失：机枪×1
消耗：穿甲弹×25，电池包×40，普通弹×350
```

### 实例 2：弹药不足导致失败

**初始配置：**
```
我方：
- 重机枪×5（穿甲弹 20 ⚠️）
- 激光×3（电池包 500）
- 机枪×10（普通弹 2000）

敌方：
- 装甲虫×3
- 护盾虫×2
- 工虫×10
```

**战斗进程：**

```
00:00 - 战斗开始
- 重机枪锁定装甲虫

00:08 - 穿甲弹耗尽！
- 重机枪×5 停火 🚫
- 装甲虫还剩 2 只

00:09 - 战况恶化
- 机枪攻击装甲虫：20×0.5×0.5 = 5 伤害
- 效率极低
- 装甲虫持续输出

00:45 - 被反推
- 机枪无人机逐渐被击毁
- 激光专注护盾虫，无法支援

01:20 - 全军覆没
结果：战败
```

**教训：** 必须准备充足弹药

### 实例 3：成功撤退

**初始配置：**
```
我方：
- 重机枪×3（穿甲弹 300）
- 机枪×5（普通弹 1000）

敌方：
- 装甲虫×5
- 工虫×20
```

**战斗进程：**

```
00:00 - 战斗开始

00:20 - 发现火力不足
- 装甲虫还剩 4 只
- 重机枪已损失 1 架
- 机枪对装甲虫几乎无效

00:25 - 玩家选择撤退
- 保留：重机枪×2，机枪×5
- 保留：穿甲弹×250，普通弹×900

回到基地：
- 补充生产 2 架重机枪
- 补充 200 穿甲弹
- 20 分钟后满编再战
```

---

## 八、平衡性参考数值

### DPS 对比表

| 单位类型 | 基础 DPS | 克制目标 DPS | 被克制 DPS |
|---------|---------|------------|-----------|
| 机枪无人机 | 20 | - | 5（vs装甲） |
| 重机枪无人机 | 20 | 40（vs装甲） | - |
| 喷火无人机 | 12 | 18（vs群体） | 9.6（vs大型） |
| 激光无人机 | 33 | 66（vs护盾） | - |
| 等离子无人机 | 35 | 45（vs高甲） | - |
| 炮台无人机 | 40 | 60（vs BOSS） | 32（vs小型） |

### 标准战斗配置

**区域 5（BOSS前）：**
```
推荐配置：
- 重机枪×8
- 机枪×12
- 总战力：280

敌方：
- 装甲虫×5，工虫×30
- 总战力：250

预计：胜率 80%，战损 2-3 架
```

**区域 10（BOSS前）：**
```
推荐配置：
- 重机枪×6
- 激光×6
- 机枪×8
- 总战力：420

敌方：
- 装甲虫×3，护盾虫×5，战虫×10
- 总战力：380

预计：胜率 75%，战损 3-5 架
```

---

*文档版本：2.0*  
*日期：2024-12-04*  
*专注内容：纯战斗系统设计*
