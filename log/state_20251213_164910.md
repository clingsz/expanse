# Project State - 2025-12-13 16:49:10

## Session Summary

### Date: December 13, 2025
### Agent: Claude Code (Sonnet 4.5)
### User: clingsz

---

## Recent Changes in This Session

### 1. GitHub Repository Setup
- Initialized git repository
- Created `.gitignore` (excludes: .DS_Store, .claude/, node_modules/, *.log)
- Created initial commit with all project files
- Pushed to GitHub: https://github.com/clingsz/expansion
- Repository is public and live

### 2. Data Consolidation
- **Problem**: Game was loading 7 separate JSON files from `data/` folder
- **Solution**: Consolidated all JSON files into single `data.json`
- **Files consolidated**:
  - items.json → data.json (35 items)
  - buildings.json → data.json (23 buildings)
  - recipes.json → data.json (26 recipes)
  - technologies.json → data.json (27 technologies)
  - units.json → data.json (6 units)
  - enemies.json → data.json (14 enemies)
  - regions.json → data.json (10 regions)
- **Updated**: game.js:288 - Changed from 7 fetch calls to 1 fetch call
- **Benefits**: Faster loading, fewer HTTP requests, easier maintenance

### 3. Project Cleanup
- Created `tests/` folder for all test-related files
- Moved files to tests/:
  - simulate.js
  - test_mining.html
  - test_mining.js
  - test.js
  - validate_data.js
- Deleted empty `data.js` file
- Deleted `data/` folder (replaced by consolidated data.json)

### 4. Development Environment Setup
- Created `run.sh` script for easy game startup
- Script starts Python HTTP server on port 8000
- Automatically opens browser to http://localhost:8000
- Made script executable (chmod +x)

### 5. Claude Code Permissions Configuration
- Updated `.claude/settings.local.json` to allow all tools: `"allow": ["*"]`
- Added alias to `~/.zshrc`: `alias claude-code='claude-code --dangerous-mode'`
- Eliminates permission prompts for smoother workflow

---

## Current Project Structure

```
expansion/
├── index.html          # Main game entry point (17K)
├── game.js             # Main game logic (176K)
├── style.css           # Main stylesheet (73K)
├── data.json           # Consolidated game data (50K)
├── run.sh              # Startup script (executable)
├── todo.md             # Project TODO list
├── .gitignore          # Git ignore rules
├── tests/              # Test files
│   ├── simulate.js
│   ├── test_mining.html
│   ├── test_mining.js
│   ├── test.js
│   └── validate_data.js
├── backup/             # Backup files
│   ├── game.js
│   ├── index.html
│   ├── index_ref.html
│   └── style.css
├── doc/                # Documentation
│   ├── DEVELOPER_MANUAL.md
│   ├── RECIPE_PRODUCTION_SYSTEM.md
│   ├── THEME_COLORS.md
│   ├── 扩张前线_游戏设计文档.md
│   ├── 扩张前线_界面设计文档.md
│   ├── 扩张前线-战斗系统设计.md
│   └── old/            # Archived documentation
└── log/                # Session logs and state files
    ├── session_2024-12-02.md
    ├── BUGFIX3.md
    ├── NEXT_STEPS.md
    └── state_20251213_164910.md (this file)
```

---

## Game Architecture Overview

### Technology Stack
- **Frontend**: Pure HTML/CSS/JavaScript (no frameworks)
- **Language**: Chinese (zh-CN) with English subtitles
- **Design**: Sci-fi theme with dark mode UI
- **Data**: JSON-based configuration
- **Server**: Python HTTP server for local development

### Core Game Systems

#### 1. Resource Management
- Mining buildings extract resources from nodes
- Production buildings process resources via recipes
- Storage system with capacity limits
- Power generation and consumption

#### 2. Technology Tree
- Research labs unlock new technologies
- Technologies unlock buildings, recipes, and units
- Science packs required for research
- Progressive unlocking system

#### 3. Combat System
- Turn-based tactical combat
- Multiple unit types with different weapons
- Enemy types with resistances/weaknesses
- Boss battles with phase transitions
- Ammo and power consumption per turn

#### 4. Region Expansion
- 10 regions with progressive difficulty
- Resource nodes in each region
- Enemy encounters
- Boss regions with special rewards

#### 5. Building System
- Categories: mining, production, power, storage, science
- Slot-based placement system
- Power consumption/production
- Tech requirements

### Game Data Structure (data.json)

```json
{
  "items": { /* 35 items: raw materials, components, ammo, science packs */ },
  "buildings": { /* 23 buildings: miners, furnaces, assemblers, power plants, etc */ },
  "recipes": { /* 26 recipes: smelting, crafting, chemical, military, nuclear */ },
  "technologies": { /* 27 techs: automation, mining, power, military, nuclear */ },
  "units": { /* 6 unit types: drones with different weapons */ },
  "enemies": { /* 14 enemy types: bugs, beetles, bosses */ },
  "regions": [ /* 10 regions: zones with resources and enemies */ ]
}
```

### Key Game Files

**index.html** (17K)
- Main menu system
- Game UI structure
- Load/Save system UI
- Settings interface

**game.js** (176K)
- Game state management
- Data loading (line 288)
- Resource calculations
- Building management
- Combat system
- UI rendering
- Save/Load functionality

**style.css** (73K)
- Sci-fi dark theme
- Color palette: cyan (#00d9ff), purple (#a855f7)
- Responsive layout
- Animation effects

---

## Important Implementation Details

### Data Loading (game.js:288)
```javascript
async function loadGameData() {
    const data = await fetch('data.json').then(r => r.json());
    GameData.items = data.items;
    GameData.buildings = data.buildings;
    GameData.recipes = data.recipes;
    GameData.technologies = data.technologies;
    GameData.units = data.units;
    GameData.enemies = data.enemies;
    GameData.regionTemplates = data.regions;
    GameData.loaded = true;
}
```

### Game Startup Flow
1. Load index.html
2. Initialize game state
3. Fetch data.json
4. Populate GameData object
5. Render main menu
6. User starts new game or loads save

---

## How to Run the Game

### Quick Start
```bash
./run.sh
```

### Manual Start
```bash
python3 -m http.server 8000
# Then open http://localhost:8000 in browser
```

### Testing
- Test files are in `tests/` folder
- Run validate_data.js to check data integrity
- simulate.js for game simulation
- test_mining.js for mining system tests

---

## Git Repository

- **URL**: https://github.com/clingsz/expansion
- **Branch**: main
- **Remote**: origin (git@github.com:clingsz/expansion.git)
- **Last Commit**: 346509b - Initial commit: Expansion game project

---

## Next Steps / TODO

### Immediate Tasks
1. Create README.md for the project
2. Commit recent changes (data consolidation, cleanup)
3. Update documentation to reflect new structure

### Future Improvements
(See todo.md for detailed list)
- Game balance testing
- Additional content (regions, enemies, techs)
- UI/UX improvements
- Performance optimization
- Mobile responsiveness

---

## Notes for Future Sessions

### Loading State
1. Read this state file (latest in log/ folder)
2. Check git status for uncommitted changes
3. Review todo.md for pending tasks
4. Check doc/ folder for design specifications

### Common Commands
```bash
./run.sh                    # Start game server
git status                  # Check changes
git add . && git commit     # Commit changes
git push                    # Push to GitHub
```

### File Locations
- **Game data**: data.json (consolidated, single source of truth)
- **Main logic**: game.js
- **Tests**: tests/ folder
- **Docs**: doc/ folder
- **State files**: log/state_*.md

### Important Notes
- DO NOT modify data/ folder (it's been deleted)
- data.json is the single source for all game data
- Always update state file when finishing a session
- Keep main folder clean (only essential files)

---

## Session Metrics

- **Duration**: ~1 hour
- **Files Modified**: 3 (game.js, .gitignore, .zshrc)
- **Files Created**: 3 (run.sh, data.json, .gitignore)
- **Files Moved**: 5 (to tests/)
- **Files Deleted**: 2 (data.js, data/ folder)
- **Commits**: 1 (initial commit)
- **Lines of Code**: ~24,140

---

## End of State Document

**Status**: Project is clean, organized, and ready for development
**Next Agent**: Should create README.md and commit cleanup changes
